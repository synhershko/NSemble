@using NSemble.Modules.Blog.Helpers
@using NSemble.Modules.Blog.Models
@using NSemble.Core.Models
@using NSemble.Core.Extensions
@inherits Nancy.ViewEngines.Razor.NancyRazorViewBase<dynamic>
@{
    Layout = "_BlogLayout.cshtml";
    BlogPost post = Model.BlogPost;
}

<div>
    <h3>@Model.BlogPost.Title</h3>
    <small>Posted @HtmlExtensions.Html5DateTimeTag(post.PublishedAt)</small>
</div>

<hr/>

<div>@NSemble.Core.Extensions.DynamicContentHelpers.CompiledContent(Model.BlogPost)</div>

<hr/>
<div>
    <a name="comments"></a>
    <p><strong>Comments</strong></p>
    @if (Model.Comments != null)
    {
        foreach (var comment in Model.Comments.Comments)
        {
            <div>
                @NSemble.Modules.Blog.Helpers.BlogPostHelpers.Gravatar(comment, 48)

                @NSemble.Core.Extensions.DynamicContentHelpers.CompiledStringContent(comment.Content, DynamicContentType.Markdown, false)
            </div>
        }
    }        
    
    <hr />
    
    @{
        var postUrl = UrlHelpers.ToUrl(post, (string) ViewBag.AreaRoutePrefix);
        var commentInput = new NSemble.Modules.Blog.Models.PostComments.CommentInput();
    }
    <form method="post" action="@postUrl/new-comment">
        <fieldset>
            <legend>Add a new comment</legend>

            <div>Name</div>
            <div>
                <input type="text" name="Author" value="@commentInput.Author" />
            </div>
         
            <div>E-mail</div>
            <div>
                <input type="text" name="Email" value="@commentInput.Email" />
            </div>
         
            <div>Website (optional)</div>
            <div>
                <input type="text" name="Website" value="@commentInput.Website" />
            </div>

            <div>
                Your comment
            </div>
            <div>
                <textarea name="Body" rows="20" style="width: 500px">@commentInput.Body</textarea>
            </div>
	     
            <div>
                2 * 4 = ?
            </div>
            <div>
                <input type="text" name="HumanVerification" value="" />
            </div>

            <p>
                <input type="submit" value="Post comment" />
            </p>
        </fieldset>
    </form>
</div>